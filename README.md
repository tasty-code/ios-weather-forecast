# ğŸŒ¤ï¸ ë‚ ì”¨ ì•±
> APIë¥¼ ì´ìš©í•˜ì—¬ ë°›ì•„ì˜¨ ë°ì´í„°ë¥¼ í†µí•´ í˜„ì¬ ë‚ ì”¨ì™€ 5ì¼ ì˜ˆë³´ë¥¼ ì•Œë ¤ì£¼ëŠ” ë‚ ì”¨ ì•±ì…ë‹ˆë‹¤.

<br>

## ğŸ‘¨ğŸ»â€ğŸ’» í”„ë¡œì íŠ¸ ì°¸ì—¬ì
|newJunsung|COMDORI|
|:--:|:--:|
|<img src="https://avatars.githubusercontent.com/u/107932188?v=4" width=200>|<img src="https://avatars.githubusercontent.com/u/22284092?v=4" width=200>|


## ğŸ“† í”„ë¡œì íŠ¸ ê¸°ê°„
> 2023.11.20. ~ 2023.12.22.

<br>

## ğŸŒŸ í”„ë¡œì íŠ¸ í•µì‹¬ì‚¬í•­
- [x] ë‚ ì”¨ ë°ì´í„°ë¥¼ APIë¥¼ ì´ìš©í•˜ì—¬ JSON ë°ì´í„° íŒŒì‹±
- [x] CodingKeys í”„ë¡œí† ì½œ í™œìš© 
- [x] ì„œë²„ì™€ í†µì‹ í•  íƒ€ì… ë° ë„¤íŠ¸ì›Œí‚¹ íƒ€ì… êµ¬í˜„
- [x] URLSession í™œìš©
- [x] CoreLocationì„ í™œìš©í•˜ì—¬ ì¢Œí‘œ, ì£¼ì†Œ êµ¬í˜„
- [x] ì»¬ë ‰ì…˜ í—¤ë“œ, ì…€ ë·°, UICollectionViewCompositionalLayout í™œìš©
- [x] ì»¬ë ‰ì…˜ ë·° ì…€ ì´ë¯¸ì§€ ì§€ì—° ë¡œë”© ë¬¸ì œ í•´ê²°ì„ ìœ„í•œ NSCache í™œìš©
- [x] ì»¬ë ‰ì…˜ ë·° DiffableDataSource í™œìš©
- [x] Refresh Controlì˜ í™œìš©
- [x] DateFormatter í™œìš©í•œ ë‚ ì§œ í‘œí˜„
- [x] UIAlertController TextField í™œìš©
- [x] ì»¤ìŠ¤í…€ ë·° êµ¬í˜„ê³¼ StackView, ì˜¤í† ë ˆì´ì•„ì›ƒ í™œìš©
- [x] ì ì ˆí•œ Extension í™œìš©
- [x] Combine í™œìš©
- [x] Xcode í”„ë¡œì íŠ¸ ê´€ë¦¬ êµ¬ì¡°ì˜ ì´í•´ì™€ ì‘ìš©

<br>


## ğŸ“· ë™ì‘ í™”ë©´
|ë‚ ì”¨ ë³´ê¸°|ìœ„ì¹˜ ë³€ê²½|ë‚ ì”¨ ìƒˆë¡œê³ ì¹¨ ë° í˜„ìœ„ì¹˜ ì¬ì„¤ì •|
|:--:|:--:|:--:|
![á„‚á…¡á†¯á„Šá…µ á„‡á…©á„€á…µ](https://github.com/newJunsung/ios-weather-forecast/assets/22284092/b9d59584-c220-4259-8ec3-7ec15ee757a1)|![á„‹á…±á„á…µ á„‡á…§á†«á„€á…§á†¼](https://github.com/newJunsung/ios-weather-forecast/assets/22284092/8335a67f-144c-4ba0-8779-1b2a7f229cbc)|![á„‚á…¡á†¯á„Šá…µ á„‰á…¢á„…á…©á„€á…©á„á…µá†· á„†á…µá†¾ á„’á…§á†«á„‹á…±á„á…µ á„‡á…§á†«á„€á…§á†¼](https://github.com/newJunsung/ios-weather-forecast/assets/22284092/ea153835-f50e-4dab-9406-ac29e834439c)



## ğŸ› ï¸ í”„ë¡œì íŠ¸ ì„¤ê³„ íŒ¨í„´
- ë””ìì¸ íŒ¨í„´: `MVC`

<br>

## ğŸ—‚ï¸ í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ êµ¬ì¡°
```
    WeatherForecast
    â”œâ”€â”€ WeatherForecast
    â”‚Â Â  â”œâ”€â”€ APIKey.plist
    â”‚Â Â  â”œâ”€â”€ AppDelegate.swift
    â”‚Â Â  â”œâ”€â”€ Assets.xcassets
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ AccentColor.colorset
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ Contents.json
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ AppIcon.appiconset
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ Contents.json
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ Contents.json
    â”‚Â Â  â”‚Â Â  â””â”€â”€ background.imageset
    â”‚Â Â  â”‚Â Â      â”œâ”€â”€ Contents.json
    â”‚Â Â  â”‚Â Â      â””â”€â”€ ios-4-1125-x-2436-2k5qyo7bymv98ccz.jpg
    â”‚Â Â  â”œâ”€â”€ Base.lproj
    â”‚Â Â  â”‚Â Â  â””â”€â”€ LaunchScreen.storyboard
    â”‚Â Â  â”œâ”€â”€ Extensions
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ CALayer+Extension.swift
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ Date+Extension.swift
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ Double+Extension.swift
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ UIAlertAction+Extension.swift
    â”‚Â Â  â”‚Â Â  â””â”€â”€ UIView+Extension.swift
    â”‚Â Â  â”œâ”€â”€ Info.plist
    â”‚Â Â  â”œâ”€â”€ Models
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ CurrentWeather.swift
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ WeatherBases.swift
    â”‚Â Â  â”‚Â Â  â””â”€â”€ WeatherForecast.swift
    â”‚Â Â  â”œâ”€â”€ Networks
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ WeatherHTTPClient.swift
    â”‚Â Â  â”‚Â Â  â””â”€â”€ WeatherURLManager.swift
    â”‚Â Â  â”œâ”€â”€ Protocols
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ HTTPClient.swift
    â”‚Â Â  â”‚Â Â  â””â”€â”€ WeatherUIDelegate.swift
    â”‚Â Â  â”œâ”€â”€ SceneDelegate.swift
    â”‚Â Â  â”œâ”€â”€ URLSession.swift
    â”‚Â Â  â”œâ”€â”€ Utils
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ Errors.swift
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ WeatherImageCache.swift
    â”‚Â Â  â”‚Â Â  â””â”€â”€ WeatherLocationManager.swift
    â”‚Â Â  â”œâ”€â”€ Views
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ WeatherCollectionViewCell.swift
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ WeatherCollectionViewHeader.swift
    â”‚Â Â  â”‚Â Â  â””â”€â”€ WeatherViewController.swift
    â”‚Â Â  â””â”€â”€ WeatherClient.swift
    â”œâ”€â”€ WeatherForecast.xcodeproj
    â”‚Â Â  â”œâ”€â”€ project.pbxproj
    â”‚Â Â  â””â”€â”€ project.xcworkspace
    â”œâ”€â”€ WeatherForecastTests
    â”‚Â Â  â”œâ”€â”€ Info.plist
    â”‚Â Â  â””â”€â”€ WeatherForecastTests.swift
    â””â”€â”€ WeatherForecastUITests
    â”‚   â”œâ”€â”€ Info.plist
    â”‚   â””â”€â”€ WeatherForecastUITests.swift
    â””â”€â”€ README.md
```

## ğŸš€ íŠ¸ëŸ¬ë¸” ìŠˆíŒ…

### fatalError ë©”ì†Œë“œì˜ ìœ„í—˜ì„±
- guardë¬¸ íƒˆì¶œì´ë‚˜ ì—ì™¸ìƒí™© í•´ê²°í•˜ê¸° ìœ„í•´ fatalError()ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ì˜€ëŠ”ë°, ì´ ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ì˜¤ë¥˜ë¥¼ ë§Œë‚¬ì„ ë•Œ ì•±ì´ ê°•ì œë¡œ ì¢…ë£Œë  ìˆ˜ ìˆëŠ” ìƒí™©ì„ ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì¤Œìœ¼ë¡œì¨ ì‚¬ìš©ìê°€ ë†€ë„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì˜¤ë¥˜ í‘œì‹œë¥¼ Alertìœ¼ë¡œ í‘œí˜„í•˜ë˜, ë‹¤ë¥¸ ë°©ì‹ìœ¼ë¡œ ì²˜ë¦¬í•˜ì—¬ ì•±ì´ ê°•ì œ ì¢…ë£Œë˜ì§€ ì•Šê²Œ í•´ì•¼ í•¨ì„ ê¹¨ë‹¬ì•˜ìŠµë‹ˆë‹¤.

```swift=
// ìˆ˜ì • ì „
guard (200..<300).contains(httpResponse.statusCode) else {
    fatalError("status code ì˜¤ë¥˜")
}

if data.count <= 0 {
    fatalError("dataê°€ ì—†ìŒ")
}

// ìˆ˜ì • í›„
guard (200..<300).contains(httpResponse.statusCode) else {
throw StatusCodeError.httpError(httpResponse.statusCode)
}

if data.count <= 0 {
    throw URLError(.zeroByteResource)
}

```

### ê°•í•œ ì°¸ì¡°ê°€ ì¼ì–´ë‚˜ëŠ” ì´ìŠˆ
```swift=
// ê°•í•œ ì°¸ì¡° ë¬¸ì œ ë°œìƒ
{ completion in
    switch completion {
    case .finished:
        return
    case .failure(let error):
        self.countryLabel.text = error.localizedDescription
        print(error)
    }
 
 // ìˆœí™˜ ì°¸ì¡° ë¬¸ì œ í•´ê²° í›„
{ [weak self] completion in
    // guard let self = self else { return }
    
    switch completion {
    case .finished:
        return
    case .failure(let error):
        self?.countryLabel.text = error.localizedDescription
    }
}
 
```
- `[weak self]`ë¡œ ìº¡ì²˜í•˜ì—¬ ìˆœí™˜ì°¸ì¡° ë¬¸ì œê°€ ë°œìƒí•˜ì§€ ì•Šê²Œ í•˜ì˜€ìŠµë‹ˆë‹¤. ë˜í•œ guard êµ¬ë¬¸ìœ¼ë¡œ selfë¥¼ ì–¸ë˜í•‘í•˜ê²Œ ë˜ë©´ ê°™ì€ ë©”ëª¨ë¦¬ë¥¼ ê°€ë¥´ì¼œ RCê°€ ì‹¤ì œë¡œ +1 ì¦ê°€ í•˜ì§€ë§Œ, ì´ êµ¬ë¬¸ì´ ëë‚¨ê³¼ ë™ì‹œì— RCê°€ -1 ë˜ê¸°ë•Œë¬¸ì— ì•½í•œì°¸ì¡°ê°€ ë˜ì–´ì„œ í•´ë‹¹ ì´ìŠˆë¥¼ í•´ê²°í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.  


### ì»¬ë ‰ì…˜ë·° ì…€ì˜ ë°ì´í„°ê°€ ë°”ë€Œì§€ ì•ŠëŠ” ì´ìŠˆ 1 [^1]
```swift=
var snapshot = NSDiffableDataSourceSnapshot<Section, Forecast>()
snapshot.appendSections([.main])
snapshot.appendItems(forecast, toSection: .main)
snapshot.reloadSections([.main])
self?.weatherDataSource.apply(snapshot)
```
- ìœ„ì˜ ì½”ë“œë¥¼ ì ìš©í•˜ë©´ í—¤ë”ì˜ ë°ì´í„°ëŠ” ë³€ê²½ë˜ë‚˜ ì…€ì˜ ë°ì´í„°ê°€ ë³€ê²½ë˜ì§€ ì•ŠëŠ” ì ì´ ìˆì–´ì„œ `self?.weatherDataSource.applySnapshotUsingReloadData(snapshot)` ë©”ì†Œë“œë¥¼ ì‚¬ìš©í–ˆìœ¼ë‚˜ ì• ë‹ˆë©”ì´ì…˜ì´ ë™ì‘í•˜ì§€ ì•ŠëŠ” ì´ìŠˆê°€ ë°œìƒí•˜ì—¬ í•œë²ˆ ë” `apply()`ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ì—¬ ìŠ¤ëƒ…ìƒ·ì˜ ë°ì´í„°ê°€ ë³€ê²½ë˜ì—ˆìŒì„ ì¸ì§€í•˜ê³  ì…€ì´ ë‹¤ì‹œ í•œë²ˆ reloadë˜ì–´ ì…€ì˜ ë°ì´í„°ë„ ìµœì‹ í™”ë˜ê³ , ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ë„ ë™ì‘í•˜ì—¬ ë¬¸ì œì ì„ í•´ê²°í•˜ì˜€ìŠµë‹ˆë‹¤.

```swift=
var snapshot = NSDiffableDataSourceSnapshot<Section, Forecast>()
snapshot.appendSections([.main])
self?.weatherDataSource.apply(snapshot)

snapshot.appendItems(forecast, toSection: .main)
snapshot.reloadSections([.main])
self?.weatherDataSource.apply(snapshot)
```

### ì»¬ë ‰ì…˜ë·° ì…€ì˜ ë°ì´í„°ê°€ ë°”ë€Œì§€ ì•ŠëŠ” ì´ìŠˆ 2 
- ìŠ¤ëƒ…ìƒ·ì´ ì»¬ë ‰ì…˜ë·°ë¥¼ ê·¸ë ¤ì£¼ëŠ” ë¶€ë¶„ì´ ë¬¸ì œê°€ ì•„ë‹ˆë¼ ê·¼ë³¸ì ì¸ ë¬¸ì œëŠ” ë°ì´í„°ë¥¼ íŒë‹¨í•´ì£¼ëŠ” ì¡°ê±´ë¬¸ì´ ì‹œê°„ìœ¼ë¡œë§Œ íŒë‹¨í•˜ì—¬ ë°ì´í„°ê°€ ë‹¬ë¼ì¡ŒìŒì—ë„ ì‹œê°„ì´ ê°™ë‹¤ê³  íŒë‹¨í•˜ì—¬ ìƒˆë¡œìš´ ë‚ ì”¨ ë°ì´í„°ë¥¼ ìµœì‹ í™” ëª» í•´ì£¼ëŠ” ë¬¸ì œê°€ ë°œìƒí•˜ì˜€ìŠµë‹ˆë‹¤. ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ë‚ ì”¨ì˜ ì˜¨ë„ë¥¼ ê°€ì§€ê³  íŒë‹¨í•´ì£¼ëŠ” ì¡°ê±´ì‹ì„ ì¶”ê°€í•˜ì—¬ `DiffableDataSource`ê°€ ë°”ë€ ë°ì´í„°ë¥¼ ì¸ì§€í•  ìˆ˜ ìˆë„ë¡ í•˜ì—¬ ì…€ì˜ ë‚ ì”¨ê°€ ë°”ë€” ìˆ˜ ìˆë„ë¡ ë¬¸ì œë¥¼ í•´ê²°í•˜ì˜€ìŠµë‹ˆë‹¤.

```swift=
// ë¬¸ì œê°€ ìˆëŠ” í•¨ìˆ˜
static func == (lhs: Forecast, rhs: Forecast) -> Bool {
    return lhs.timeOfData == rhs.timeOfData
}

// ì´ìŠˆë¥¼ í•´ê²°í•œ í•¨ìˆ˜
static func == (lhs: Forecast, rhs: Forecast) -> Bool {
    return lhs.timeOfData == rhs.timeOfData && lhs.mainInfo.temperature == rhs.mainInfo.temperature
}
```

[^1]: https://velog.io/@alexcho617/Realm-DiffableDataSource
